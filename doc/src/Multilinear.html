<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module      : Multilinear
Description : A (multi)linear algbra library.
Copyright   : (c) Artur M. Brodzki, 2017
License     : GPL-3
Maintainer  : artur.brodzki@gmail.com
Stability   : experimental
Portability : Windows/POSIX

Multilinear library provides efficient and terse way to deal with linear algebra in Haskell. It is based on concept of tensor - a multidimensional indexed array of numbers. Vectors, matrices and linear functionals are examples of low-order tensors.

= Quick tutorial

Tensors are indexed, each having one or several indices numbering its components. A scalar has no indices, as being simply a value. A vector has one index, because it is a one-dimensional list of numbers. A matrix has two indices, being a bidimensional table of numbers. Tensors are arbitrarily - dimensional, so you can have a vector of matrices (third-order tensor) and so on. Such tensors are especially useful when dealing with more complex task, such as programming neural networks e.g. for deep learning.

Index may be either __lower (contravariant)__ or __upper (covariant)__, depending on its function.

A vector has one __upper__ or __contravariant__ index, because it represents a value, point in a space. A linear functional (called in this library as a __form__) is represented as a list of numbers, similar to vector, but it does not indicate a value, but rather a coefficients of __linear map__  or __transformation__ that takes a vector and returns a number, simply by calculating a linear combination of vector components with weights being a linear functional coefficients. So elements of linear functional are indexed by __lower__ or __covariant__ index.

A matrix also represents a linear transformation, similar to linear functional, but it take a vector and return a vector, not a scalar. So matrix is simply a bunch of linear functionals - each one is a matrix row and returns a one element of resulting vector. These linear functionals are also indexed - of course by an contravariant index, as vector, which is returned by a matrix. So matrix is a tensor with two indices - one uppper (contravariant) and one lower (covariant).

A dot product is - what a surprise! - a linear transformation. But it is different from matrix - it takes two vectors to multiplicate and returns one number. So it needs two lower (covariant) indices. In fact, a dot product is represented as a bidimensional table of numbers - as matrix - but with two lower indices, instead of one upper and one lower. Tensors with several lower indices are called n-forms. Actually, many linear maps that takes two vectors and returns a number are represented in such notation. A dot product is a table filled with zeros but having a 1-s in diagonal of the table - it look visually identical like unit matrix, but it isn't a matrix - it's actually a 2-form. In this library dot product is called (as in abstract maths) a __Kronecker delta__ (in &quot;Multilinear.NForm&quot;&quot;).

A cross product takes two vectors and returns a vector of numbers. So, as you can guess, it has three indices - two covariant (lower) and one upper (contravariant). A tensor that corresponds to cross product is called Levi-Civita symbol and is implemented under &quot;Multilinear.Tensor&quot;.

As you see, multidimensional indexed arrays - tensors - provide a unified way to deal with linear algebra - such with data (vectors) and functions operating on them (matrices, n-forms). Using tensors instead of limited number of pre-defined functions, you gain a power of universal formalism, where you can express any linear function you want to deal with.

When you apply a linear functional to a vector, you compute a linear combination - or a weighted sum - of its components. It is so common operation in linear algebra,
that it requires a convenient way to note. Einstein (1905) introduced a summation rule:

If you multiply a tensor with lower index __/i/__ by a tensor with upper index with same name __/i__ then the linear combination of its components is automatically computed. The only condition is that an index of vector and index of corresponding linear transformation must have the same name.

== Examples

@

&gt;&gt;&gt; v = Vector.fromIndices &quot;i&quot; 5 $ \\i -&gt; i + 2 (vector v has 5 elements and v[i] = i + 2, indexing from 0)
&gt;&gt;&gt; v
\&lt;i:5\&gt;
   | 2
   | 3
   | 4
   | 5
   | 6
&gt;&gt;&gt; f = Form.const &quot;i&quot; 5 1 (linear functional has 5 elements and f[i] = 1)
&gt;&gt;&gt; f
[i:5] [1,1,1,1,1]
&gt;&gt;&gt; f * v
20
@

If you want to apply a vector to matrix, you must simply multiply them. The only condition is - as you can guess - that lower (indicating that matrix is a linear transformation) index of matrix must have the same name as the upper index of vector (indicating that this vector is a argument of matrix linear transformation; an upper index of matrix here indicates that this linear transformation returns a vector)

@

&gt;&gt;&gt; m = Matrix.fromIndices &quot;ij&quot; 5 5 $ \\i j -&gt; i + j
&gt;&gt;&gt; m
\&lt;i:5\&gt;
   | [j:5] [0,1,2,3,4]
   | [j:5] [1,2,3,4,5]
   | [j:5] [2,3,4,5,6]
   | [j:5] [3,4,5,6,7]
   | [j:5] [4,5,6,7,8]
&gt;&gt;&gt; v = Vector.fromIndices &quot;j&quot; 5 $ \\j -&gt; j (vector v has 5 elements and v[j] = j, indexing from 0)
&gt;&gt;&gt; v
\&lt;j:5\&gt;
   | 0
   | 1
   | 2
   | 3
   | 4
&gt;&gt;&gt; m * v
\&lt;i:5\&gt;
   | 30
   | 40
   | 50
   | 60
   | 70
@
Note, that result vector is indexed with &quot;i&quot; - the same index as uppper index of our matrix.

If you want to do a matrix multiplication, a lower index of first matrix must have the same name as upper index of second matrix.

@

&gt;&gt;&gt; m1 = Matrix.fromIndices &quot;ij&quot; 3 5 $ \\i j -&gt; i + j
&gt;&gt;&gt; m1
\&lt;i:3\&gt;
   | [j:5] [0,1,2,3,4]
   | [j:5] [1,2,3,4,5]
   | [j:5] [2,3,4,5,6]
&gt;&gt;&gt; m2 = Matrix.fromIndices &quot;jk&quot; 5 4 $ \\j -&gt; i + j (vector v has 5 elements and v[j] = j, indexing from 0)
&gt;&gt;&gt; m2
\&lt;j:5\&gt;
   | [k:4] [0,1,2,3]
   | [k:4] [1,2,3,4]
   | [k:4] [2,3,4,5]
   | [k:4] [3,4,5,6]
   | [k:4] [4,5,6,7]
&gt;&gt;&gt; m1 * m2
\&lt;i:3\&gt;
   | [k:4] [30,40,50,60]
   | [k:4] [40,50,60,70]
   | [k:4] [50,60,70,80]
@

Note, that rule that first matrix lower index must be the same as the second matrix upper index corresponeds to the fact, that to multiply two matrices, the widht of first matrix must be the same as width of the second matrix. The rule of matrix multiplication guarantees, that this operation is equivalent to linear functions composition.

The dot product of vectors may be done by simply making one of vectors with lower index, or - more correctly - by applying two vectors to Kronecker delta:

@

&gt;&gt;&gt; v1 = Vector.fromIndices &quot;i&quot; 5 $ \\i -&gt; i + 2 (vector v has 5 elements and v[i] = i + 2, indexing from 0)
&gt;&gt;&gt; v1
\&lt;i:5\&gt;
   | 2
   | 3
   | 4
   | 5
   | 6
&gt;&gt;&gt; v2 = Vector.fromIndices &quot;j&quot; 5 $ \\j -&gt; j (vector v has 5 elements and v[j] = j, indexing from 0)
&gt;&gt;&gt; v2
\&lt;j:5\&gt;
   | 0
   | 1
   | 2
   | 3
   | 4
&gt;&gt;&gt; v1 * (lower &quot;j&quot; v2)
50
&gt;&gt;&gt; NForm.dot 5 &quot;ij&quot; * v1 * v2 (A Kronecker delta - representing a dot product - of size 5 with indices \&quot;i\&quot; and \&quot;j\&quot; is multiplied by v1 and v2)
50

@

If you want to know more about linear algebra and Einstein convention, read Wikipedia:

- &lt;https://en.wikipedia.org/wiki/Matrix_(mathematics)&gt;
- &lt;https://en.wikipedia.org/wiki/Covariance_and_contravariance_of_vectors&gt;
- &lt;https://en.wikipedia.org/wiki/Einstein_notation&gt;

-}</span><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts      #-}</span><span>
</span><a name="line-145"></a><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><a name="line-146"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies          #-}</span><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Multilinear</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-149"></a><span>    </span><a href="Multilinear.html#Multilinear"><span class="hs-identifier hs-type">Multilinear</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-150"></a><span>    </span><a href="Multilinear.html#Accessible"><span class="hs-identifier hs-type">Accessible</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Multilinear.html#StandardTensor"><span class="hs-identifier hs-type">StandardTensor</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-151"></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">DeepSeq</span><span>
</span><a name="line-154"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Trans</span><span class="hs-operator">.</span><span class="hs-identifier">Either</span><span>
</span><a name="line-155"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control</span><span class="hs-operator">.</span><span class="hs-identifier">Monad</span><span class="hs-operator">.</span><span class="hs-identifier">Trans</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>
</span><a name="line-156"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Aeson</span><span>
</span><a name="line-157"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">ByteString</span><span class="hs-operator">.</span><span class="hs-identifier">Lazy</span><span>       </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">ByteString</span><span>
</span><a name="line-158"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>
</span><a name="line-159"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Serialize</span><span>
</span><a name="line-160"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Set</span><span>
</span><a name="line-161"></a><span class="hs-keyword">import</span><span>           </span><a href="Multilinear.Index.html"><span class="hs-identifier">Multilinear</span><span class="hs-operator">.</span><span class="hs-identifier">Index</span></a><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span class="hs-comment">{-| Multidimensional array treated as multilinear map - tensor -}</span><span>
</span><a name="line-164"></a><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-165"></a><span>  </span><span class="hs-identifier hs-type">Num</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- Tensors may be added, subtracted and multiplicated</span><span>
</span><a name="line-166"></a><span>  </span><span class="hs-identifier hs-type">Monoid</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- Tensors are monoids with concatenation as monoid operation</span><span>
</span><a name="line-167"></a><span>  </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- Tensor should be a Functor for convenience</span><span>
</span><a name="line-168"></a><span>  </span><span class="hs-identifier hs-type">NFData</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Tensor must be possible to be fully evaluated - crucial for parallelization</span><span>
</span><a name="line-169"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="Multilinear"><a href="Multilinear.html#Multilinear"><span class="hs-identifier">Multilinear</span></a></a><span> </span><a name="local-6989586621679096954"><a href="#local-6989586621679096954"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679096955"><a href="#local-6989586621679096955"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-170"></a><span>
</span><a name="line-171"></a><span>    </span><span class="hs-comment">{-| Add scalar @a@ to each element of tensor @t@ -}</span><span>
</span><a name="line-172"></a><span>    </span><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">7</span><span> </span><span class="hs-operator">.+</span><span>
</span><a name="line-173"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">+.</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-174"></a><span>
</span><a name="line-175"></a><span>    </span><span class="hs-comment">{-| Subtract each element of tensor @t@ from scalar scalar left -}</span><span>
</span><a name="line-176"></a><span>    </span><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">7</span><span> </span><span class="hs-operator">.-</span><span>
</span><a name="line-177"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">-.</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-178"></a><span>
</span><a name="line-179"></a><span>    </span><span class="hs-comment">{-| Multiply scalar @a@ by each element of tensor @t@ -}</span><span>
</span><a name="line-180"></a><span>    </span><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-operator">.*</span><span>
</span><a name="line-181"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">*.</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span>    </span><span class="hs-comment">{-| Add each element of tensor @t@ to scalar @a@ -}</span><span>
</span><a name="line-184"></a><span>    </span><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">7</span><span> </span><span class="hs-operator">+.</span><span>
</span><a name="line-185"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">.+</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span>    </span><span class="hs-comment">{-| Subtract scalar @a@ from each element of tensor @t@ -}</span><span>
</span><a name="line-188"></a><span>    </span><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">7</span><span> </span><span class="hs-operator">-.</span><span>
</span><a name="line-189"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">.-</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span>    </span><span class="hs-comment">{-| Multiply each element of tensor @t@ by scalar @a@ -}</span><span>
</span><a name="line-192"></a><span>    </span><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-operator">*.</span><span>
</span><a name="line-193"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">.*</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span>    </span><span class="hs-comment">{-| List of all tensor indices -}</span><span>
</span><a name="line-196"></a><span>    </span><span class="hs-identifier">indices</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Multilinear.Index.html#TIndex"><span class="hs-identifier hs-type">TIndex</span></a><span class="hs-special">]</span><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span>    </span><span class="hs-comment">{-| List of tensor indices names -}</span><span>
</span><a name="line-199"></a><span>    </span><span class="hs-identifier">indicesNames</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-200"></a><span>    </span><a name="local-8214565720323871830"><a href="Multilinear.html#indicesNames"><span class="hs-identifier">indicesNames</span></a></a><span> </span><a name="local-6989586621679097205"><a href="#local-6989586621679097205"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Multilinear.Index.html#indexName"><span class="hs-identifier hs-var">indexName</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Multilinear.html#indices"><span class="hs-identifier hs-var">indices</span></a><span> </span><a href="#local-6989586621679097205"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-201"></a><span>
</span><a name="line-202"></a><span>    </span><span class="hs-comment">{-| Tensor order - number of covariant and contravariant indices -}</span><span>
</span><a name="line-203"></a><span>    </span><span class="hs-comment">{-| @order t = (cv, cov)@ where @cv@ is number of upper and @cov@ is number of lower indices -}</span><span>
</span><a name="line-204"></a><span>    </span><span class="hs-identifier">order</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a><span>    </span><span class="hs-comment">{-| Return size of index with given name of Nothing if index is infinite-dimensional -}</span><span>
</span><a name="line-207"></a><span>    </span><span class="hs-identifier">size</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-208"></a><span>
</span><a name="line-209"></a><span>    </span><span class="hs-comment">{-| Check if tensors are equivalent (have same indices but in different order) -}</span><span>
</span><a name="line-210"></a><span>    </span><span class="hs-identifier">equiv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-211"></a><span>    </span><a name="local-8214565720323871833"><a href="Multilinear.html#equiv"><span class="hs-identifier">equiv</span></a></a><span> </span><a name="local-6989586621679097215"><a href="#local-6989586621679097215"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679097216"><a href="#local-6989586621679097216"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Data</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-special">(</span><a href="Multilinear.html#indices"><span class="hs-identifier hs-var">indices</span></a><span> </span><a href="#local-6989586621679097215"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">Data</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Set</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">fromList</span><span> </span><span class="hs-special">(</span><a href="Multilinear.html#indices"><span class="hs-identifier hs-var">indices</span></a><span> </span><a href="#local-6989586621679097216"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">)</span><span>
</span><a name="line-212"></a><span>
</span><a name="line-213"></a><span>    </span><span class="hs-comment">{-| Infix equivalent of 'equiv'. Has low priority equal to 1. |-}</span><span>
</span><a name="line-214"></a><span>    </span><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator">|==|</span><span>
</span><a name="line-215"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">|==|</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-216"></a><span>    </span><a name="local-6989586621679097217"><a href="#local-6989586621679097217"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-8214565720323871834"><a href="Multilinear.html#%7C%3D%3D%7C"><span class="hs-operator">|==|</span></a></a><span> </span><a name="local-6989586621679097218"><a href="#local-6989586621679097218"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Multilinear.html#equiv"><span class="hs-identifier hs-var">equiv</span></a><span> </span><a href="#local-6989586621679097217"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621679097218"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span>    </span><span class="hs-comment">{-| @rename t &quot;i&quot; &quot;j&quot;@ renames index @i@ of tensor @t@ to @j@ -}</span><span>
</span><a name="line-219"></a><span>    </span><span class="hs-identifier">rename</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span>    </span><span class="hs-comment">{-| @raise t &quot;i&quot;@ raises an index @i@ of tensor @t@ -}</span><span>
</span><a name="line-222"></a><span>    </span><span class="hs-identifier">raise</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-223"></a><span>    </span><a name="local-8214565720323871836"><a href="Multilinear.html#raise"><span class="hs-identifier">raise</span></a></a><span> </span><a name="local-6989586621679097219"><a href="#local-6989586621679097219"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679097220"><a href="#local-6989586621679097220"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679097219"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="Multilinear.html#%2F%5C"><span class="hs-operator hs-var">/\</span></a><span> </span><a href="#local-6989586621679097220"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-224"></a><span>
</span><a name="line-225"></a><span>    </span><span class="hs-comment">{-| Infix equivalent of 'raise' -}</span><span>
</span><a name="line-226"></a><span>    </span><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-operator">/\</span><span>
</span><a name="line-227"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">/\</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-228"></a><span>    </span><a name="local-6989586621679097221"><a href="#local-6989586621679097221"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-8214565720323871837"><a href="Multilinear.html#%2F%5C"><span class="hs-operator">/\</span></a></a><span> </span><a name="local-6989586621679097222"><a href="#local-6989586621679097222"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Multilinear.html#raise"><span class="hs-identifier hs-var">raise</span></a><span> </span><a href="#local-6989586621679097221"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621679097222"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-229"></a><span>
</span><a name="line-230"></a><span>    </span><span class="hs-comment">{-| @lower t &quot;i&quot;@ lowers an index @i@ of tensor @t@ -}</span><span>
</span><a name="line-231"></a><span>    </span><span class="hs-identifier">lower</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-232"></a><span>    </span><a name="local-8214565720323871838"><a href="Multilinear.html#lower"><span class="hs-identifier">lower</span></a></a><span> </span><a name="local-6989586621679097223"><a href="#local-6989586621679097223"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679097224"><a href="#local-6989586621679097224"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679097223"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="Multilinear.html#%5C%2F"><span class="hs-operator hs-var">\/</span></a><span> </span><a href="#local-6989586621679097224"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span>    </span><span class="hs-comment">{-| Infix equivalent of 'lower' -}</span><span>
</span><a name="line-235"></a><span>    </span><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-operator">\/</span><span>
</span><a name="line-236"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">\/</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-237"></a><span>    </span><a name="local-6989586621679097225"><a href="#local-6989586621679097225"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-8214565720323871839"><a href="Multilinear.html#%5C%2F"><span class="hs-operator">\/</span></a></a><span> </span><a name="local-6989586621679097226"><a href="#local-6989586621679097226"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Multilinear.html#lower"><span class="hs-identifier hs-var">lower</span></a><span> </span><a href="#local-6989586621679097225"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621679097226"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-238"></a><span>
</span><a name="line-239"></a><span>    </span><span class="hs-comment">{-| Switch all indices of tensor @t@ - upper indices becomes lower and vice versa -}</span><span>
</span><a name="line-240"></a><span>    </span><span class="hs-identifier">transpose</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-241"></a><span>
</span><a name="line-242"></a><span>    </span><span class="hs-comment">{-| Shift tensor index right -}</span><span>
</span><a name="line-243"></a><span>    </span><span class="hs-comment">{-| @shiftRight t &quot;i&quot;@ moves index @i@ of tensor @t@ one level depeer in recursion.
        Elements of tensor as indexed with indices names becomes unchanged. -}</span><span>
</span><a name="line-245"></a><span>    </span><span class="hs-identifier">shiftRight</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-246"></a><span>    </span><span class="hs-comment">-- ^ Right shift of an index is equivalent to left shift of its successor in recursion @s@, if only @s@ exists, so:</span><span>
</span><a name="line-247"></a><span>    </span><span class="hs-comment">-- Given a tensor @t[i1,i2,i3,...]@: @shiftRight t &quot;i2&quot; == t[i1,i3,i2,...] == shiftLeft t &quot;i3&quot;@</span><span>
</span><a name="line-248"></a><span>    </span><a name="local-8214565720323871841"><a href="Multilinear.html#shiftRight"><span class="hs-identifier">shiftRight</span></a></a><span> </span><a name="local-6989586621679097227"><a href="#local-6989586621679097227"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679097228"><a href="#local-6989586621679097228"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-249"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679097229"><span class="hs-identifier hs-var">successor</span></a><span> </span><a href="#local-6989586621679097228"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><a href="Multilinear.html#indicesNames"><span class="hs-identifier hs-var">indicesNames</span></a><span> </span><a href="#local-6989586621679097227"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Multilinear.html#shiftLeft"><span class="hs-identifier hs-var">shiftLeft</span></a><span> </span><a href="#local-6989586621679097227"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679097229"><span class="hs-identifier hs-var">successor</span></a><span> </span><a href="#local-6989586621679097228"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><a href="Multilinear.html#indicesNames"><span class="hs-identifier hs-var">indicesNames</span></a><span> </span><a href="#local-6989586621679097227"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-250"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679097227"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-251"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-252"></a><span>        </span><a name="local-6989586621679097229"><a href="#local-6989586621679097229"><span class="hs-identifier">successor</span></a></a><span> </span><a name="local-6989586621679097230"><a href="#local-6989586621679097230"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679097231"><a href="#local-6989586621679097231"><span class="hs-identifier">a1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679097232"><a href="#local-6989586621679097232"><span class="hs-identifier">a2</span></a></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679097230"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679097231"><span class="hs-identifier hs-var">a1</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679097232"><span class="hs-identifier hs-var">a2</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679097229"><span class="hs-identifier hs-var">successor</span></a><span> </span><a href="#local-6989586621679097230"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679097232"><span class="hs-identifier hs-var">a2</span></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>        </span><span class="hs-identifier">successor</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-254"></a><span>
</span><a name="line-255"></a><span>    </span><span class="hs-comment">{-| Infix equivalent of 'shiftRight' -}</span><span>
</span><a name="line-256"></a><span>    </span><span class="hs-comment">{-| @t |&gt;&gt; &quot;i&quot;@ moves index @i@ of tensor @t@ one level depeer in recursion -}</span><span>
</span><a name="line-257"></a><span>    </span><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">9</span><span> </span><span class="hs-operator">|&gt;&gt;</span><span>
</span><a name="line-258"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">|&gt;&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-259"></a><span>    </span><a name="local-6989586621679097234"><a href="#local-6989586621679097234"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-8214565720323871842"><a href="Multilinear.html#%7C%3E%3E"><span class="hs-operator">|&gt;&gt;</span></a></a><span> </span><a name="local-6989586621679097235"><a href="#local-6989586621679097235"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Multilinear.html#shiftRight"><span class="hs-identifier hs-var">shiftRight</span></a><span> </span><a href="#local-6989586621679097234"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621679097235"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span>    </span><span class="hs-comment">{-| Shift tensor index rightmost -}</span><span>
</span><a name="line-262"></a><span>    </span><span class="hs-comment">{-| @shiftRightmost t &quot;i&quot;@ moves index @i@ of tensor @t@ to the deepest level in recursion.
        Elements of tensor as indexed with indices names becomes unchanged.  -}</span><span>
</span><a name="line-264"></a><span>    </span><span class="hs-identifier">shiftRightmost</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-265"></a><span>    </span><a name="local-8214565720323871843"><a href="Multilinear.html#shiftRightmost"><span class="hs-identifier">shiftRightmost</span></a></a><span> </span><a name="local-6989586621679097236"><a href="#local-6989586621679097236"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679097237"><a href="#local-6989586621679097237"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">until</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679097238"><a href="#local-6989586621679097238"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679097237"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">last</span><span> </span><span class="hs-special">(</span><a href="Multilinear.html#indicesNames"><span class="hs-identifier hs-var">indicesNames</span></a><span> </span><a href="#local-6989586621679097238"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Multilinear.html#%7C%3E%3E"><span class="hs-operator hs-var">|&gt;&gt;</span></a><span> </span><a href="#local-6989586621679097237"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679097236"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-266"></a><span>
</span><a name="line-267"></a><span>    </span><span class="hs-comment">{-| Infix equivalent of 'shiftRightmost' -}</span><span>
</span><a name="line-268"></a><span>    </span><span class="hs-comment">{-| @t |&gt;&gt;&gt; &quot;i&quot;@ moves index @i@ of tensor @t@ to the deepest level in recursion -}</span><span>
</span><a name="line-269"></a><span>    </span><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">9</span><span> </span><span class="hs-operator">|&gt;&gt;&gt;</span><span>
</span><a name="line-270"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">|&gt;&gt;&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-271"></a><span>    </span><a name="local-6989586621679097421"><a href="#local-6989586621679097421"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-8214565720323871844"><a href="Multilinear.html#%7C%3E%3E%3E"><span class="hs-operator">|&gt;&gt;&gt;</span></a></a><span> </span><a name="local-6989586621679097422"><a href="#local-6989586621679097422"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Multilinear.html#shiftRightmost"><span class="hs-identifier hs-var">shiftRightmost</span></a><span> </span><a href="#local-6989586621679097421"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621679097422"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-272"></a><span>
</span><a name="line-273"></a><span>    </span><span class="hs-comment">{-| Shift tensor index left. Elements of tensor as indexed with indices names becomes unchanged. -}</span><span>
</span><a name="line-274"></a><span>    </span><span class="hs-comment">{-| @shiftLeft t &quot;i&quot;@ moves index @i@ of tensor @t@ one level up in recursion -}</span><span>
</span><a name="line-275"></a><span>    </span><span class="hs-identifier">shiftLeft</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-276"></a><span>    </span><span class="hs-comment">-- ^ Left shift of an index is equivalent to right shift of its predecessor in recursion @p@, if only @p@ exists, so:</span><span>
</span><a name="line-277"></a><span>    </span><span class="hs-comment">-- Given a tensor t[i1,i2,i3,...]: @shiftLeft t &quot;i3&quot; == t[i1,i3,i2,...] == shiftRight t &quot;i2&quot;@</span><span>
</span><a name="line-278"></a><span>    </span><a name="local-8214565720323871845"><a href="Multilinear.html#shiftLeft"><span class="hs-identifier">shiftLeft</span></a></a><span> </span><a name="local-6989586621679097423"><a href="#local-6989586621679097423"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679097424"><a href="#local-6989586621679097424"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-279"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679097425"><span class="hs-identifier hs-var">predecessor</span></a><span> </span><a href="#local-6989586621679097424"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><a href="Multilinear.html#indicesNames"><span class="hs-identifier hs-var">indicesNames</span></a><span> </span><a href="#local-6989586621679097423"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Multilinear.html#shiftRight"><span class="hs-identifier hs-var">shiftRight</span></a><span> </span><a href="#local-6989586621679097423"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679097425"><span class="hs-identifier hs-var">predecessor</span></a><span> </span><a href="#local-6989586621679097424"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><a href="Multilinear.html#indicesNames"><span class="hs-identifier hs-var">indicesNames</span></a><span> </span><a href="#local-6989586621679097423"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-280"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679097423"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-281"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-282"></a><span>        </span><a name="local-6989586621679097425"><a href="#local-6989586621679097425"><span class="hs-identifier">predecessor</span></a></a><span> </span><a name="local-6989586621679097426"><a href="#local-6989586621679097426"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679097427"><a href="#local-6989586621679097427"><span class="hs-identifier">a1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679097428"><a href="#local-6989586621679097428"><span class="hs-identifier">a2</span></a></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679097426"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679097428"><span class="hs-identifier hs-var">a2</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679097427"><span class="hs-identifier hs-var">a1</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679097425"><span class="hs-identifier hs-var">predecessor</span></a><span> </span><a href="#local-6989586621679097426"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679097428"><span class="hs-identifier hs-var">a2</span></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-283"></a><span>        </span><span class="hs-identifier">predecessor</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-284"></a><span>
</span><a name="line-285"></a><span>    </span><span class="hs-comment">{-| Infix equivalent to 'shiftLeft' -}</span><span>
</span><a name="line-286"></a><span>    </span><span class="hs-comment">{-| @t &lt;&lt;| &quot;i&quot;@ moves index @i@ of tensor @t@ one level up in recursion -}</span><span>
</span><a name="line-287"></a><span>    </span><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">9</span><span> </span><span class="hs-operator">&lt;&lt;|</span><span>
</span><a name="line-288"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">&lt;&lt;|</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-289"></a><span>    </span><a name="local-6989586621679097430"><a href="#local-6989586621679097430"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-8214565720323871846"><a href="Multilinear.html#%3C%3C%7C"><span class="hs-operator">&lt;&lt;|</span></a></a><span> </span><a name="local-6989586621679097431"><a href="#local-6989586621679097431"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Multilinear.html#shiftRight"><span class="hs-identifier hs-var">shiftRight</span></a><span> </span><a href="#local-6989586621679097430"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621679097431"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-290"></a><span>
</span><a name="line-291"></a><span>    </span><span class="hs-comment">{-| Shift tensor index leftmost. Elements of tensor as indexed with indices names becomes unchanged. -}</span><span>
</span><a name="line-292"></a><span>    </span><span class="hs-comment">{-| @shiftLeftmost t &quot;i&quot;@ moves index @i@ of tensor @t@ to the first level in recursion -}</span><span>
</span><a name="line-293"></a><span>    </span><span class="hs-identifier">shiftLeftmost</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-294"></a><span>    </span><a name="local-8214565720323871847"><a href="Multilinear.html#shiftLeftmost"><span class="hs-identifier">shiftLeftmost</span></a></a><span> </span><a name="local-6989586621679097432"><a href="#local-6989586621679097432"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679097433"><a href="#local-6989586621679097433"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">until</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679097434"><a href="#local-6989586621679097434"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679097433"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">last</span><span> </span><span class="hs-special">(</span><a href="Multilinear.html#indicesNames"><span class="hs-identifier hs-var">indicesNames</span></a><span> </span><a href="#local-6989586621679097434"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Multilinear.html#%3C%3C%7C"><span class="hs-operator hs-var">&lt;&lt;|</span></a><span> </span><a href="#local-6989586621679097433"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679097432"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-295"></a><span>
</span><a name="line-296"></a><span>    </span><span class="hs-comment">{-| Infix equivalent of 'shiftLeftmost' -}</span><span>
</span><a name="line-297"></a><span>    </span><span class="hs-comment">{-| @t &lt;&lt;&lt;| &quot;i&quot;@ moves index @i@ of tensor @t@ to the first level in recursion -}</span><span>
</span><a name="line-298"></a><span>    </span><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">9</span><span> </span><span class="hs-operator">&lt;&lt;&lt;|</span><span>
</span><a name="line-299"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">&lt;&lt;&lt;|</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-300"></a><span>    </span><a name="local-6989586621679097435"><a href="#local-6989586621679097435"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-8214565720323871848"><a href="Multilinear.html#%3C%3C%3C%7C"><span class="hs-operator">&lt;&lt;&lt;|</span></a></a><span> </span><a name="local-6989586621679097436"><a href="#local-6989586621679097436"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Multilinear.html#shiftLeftmost"><span class="hs-identifier hs-var">shiftLeftmost</span></a><span> </span><a href="#local-6989586621679097435"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="#local-6989586621679097436"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-301"></a><span>
</span><a name="line-302"></a><span>    </span><span class="hs-comment">{-| Concatenation of two tensors by common index -}</span><span>
</span><a name="line-303"></a><span>    </span><span class="hs-comment">{-| Tensors must be equivalent: 'equiv' t1 t2 == True -}</span><span>
</span><a name="line-304"></a><span>    </span><span class="hs-identifier">augment</span><span> </span><span class="hs-glyph">::</span><span>  </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-305"></a><span>
</span><a name="line-306"></a><span>    </span><span class="hs-comment">{-| Simple mapping -}</span><span>
</span><a name="line-307"></a><span>    </span><span class="hs-comment">{-| @map f t@ returns tensor @t2@ in which @t2[i1,i2,...] = f t[i1,i2,...]@ -}</span><span>
</span><a name="line-308"></a><span>    </span><span class="hs-identifier">map</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679097014"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679097014"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-309"></a><span>    </span><a name="local-8214565720323871850"><a href="Multilinear.html#map"><span class="hs-identifier">map</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span>
</span><a name="line-310"></a><span>
</span><a name="line-311"></a><span>    </span><span class="hs-comment">{-| Serialize to binary string -}</span><span>
</span><a name="line-312"></a><span>    </span><span class="hs-identifier">toBinary</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-313"></a><span>        </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-314"></a><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>                     </span><span class="hs-comment">-- ^ Tensor to serialize</span><span>
</span><a name="line-315"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>   </span><span class="hs-comment">-- ^ Tensor serialized to binary string</span><span>
</span><a name="line-316"></a><span>
</span><a name="line-317"></a><span>    </span><span class="hs-comment">{-| Write to binary file. Uses compression with gzip -}</span><span>
</span><a name="line-318"></a><span>    </span><span class="hs-identifier">toBinaryFile</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-319"></a><span>        </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-320"></a><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>         </span><span class="hs-comment">-- ^ File name</span><span>
</span><a name="line-321"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>            </span><span class="hs-comment">-- ^ Tensor to serialize</span><span>
</span><a name="line-322"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-323"></a><span>
</span><a name="line-324"></a><span>    </span><span class="hs-comment">{-| Deserialize from binary string -}</span><span>
</span><a name="line-325"></a><span>    </span><span class="hs-identifier">fromBinary</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-326"></a><span>        </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-327"></a><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>          </span><span class="hs-comment">-- ^ Binary string to deserialize</span><span>
</span><a name="line-328"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>            </span><span class="hs-comment">-- ^ Deserialized tensor or deserialization error message</span><span>
</span><a name="line-329"></a><span>
</span><a name="line-330"></a><span>    </span><span class="hs-comment">{-| Read from binary file -}</span><span>
</span><a name="line-331"></a><span>    </span><span class="hs-identifier">fromBinaryFile</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-332"></a><span>        </span><span class="hs-identifier hs-type">Serialize</span><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-333"></a><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>                             </span><span class="hs-comment">-- ^ File name</span><span>
</span><a name="line-334"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">EitherT</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>            </span><span class="hs-comment">-- ^ Deserialized tensor or deserialization error message - either way, wrapped in the IO monad</span><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span>
</span><a name="line-337"></a><span>    </span><span class="hs-comment">{-| Serialize to JSON string -}</span><span>
</span><a name="line-338"></a><span>    </span><span class="hs-identifier">toJSON</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-339"></a><span>        </span><span class="hs-identifier hs-type">ToJSON</span><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-340"></a><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>                     </span><span class="hs-comment">-- ^ Tensor to serialize</span><span>
</span><a name="line-341"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>   </span><span class="hs-comment">-- ^ Binary string with JSON-encoded tensor</span><span>
</span><a name="line-342"></a><span>
</span><a name="line-343"></a><span>    </span><span class="hs-comment">{-| Write to JSON file -}</span><span>
</span><a name="line-344"></a><span>    </span><span class="hs-identifier">toJSONFile</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-345"></a><span>        </span><span class="hs-identifier hs-type">ToJSON</span><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-346"></a><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>          </span><span class="hs-comment">-- ^ File name</span><span>
</span><a name="line-347"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>             </span><span class="hs-comment">-- ^ Tensor to serialize</span><span>
</span><a name="line-348"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-349"></a><span>
</span><a name="line-350"></a><span>    </span><span class="hs-comment">{-| Deserialize from JSON string -}</span><span>
</span><a name="line-351"></a><span>    </span><span class="hs-identifier">fromJSON</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-352"></a><span>        </span><span class="hs-identifier hs-type">FromJSON</span><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-353"></a><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">ByteString</span><span class="hs-operator hs-type">.</span><span class="hs-identifier hs-type">ByteString</span><span>    </span><span class="hs-comment">-- ^ Binary string with JSON-encoded tensor</span><span>
</span><a name="line-354"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>              </span><span class="hs-comment">-- ^ Deserialized tensor or an error</span><span>
</span><a name="line-355"></a><span>
</span><a name="line-356"></a><span>    </span><span class="hs-comment">{-| Read from JSON file -}</span><span>
</span><a name="line-357"></a><span>    </span><span class="hs-identifier">fromJSONFile</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-358"></a><span>        </span><span class="hs-identifier hs-type">FromJSON</span><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-359"></a><span>        </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>                      </span><span class="hs-comment">-- ^ File name</span><span>
</span><a name="line-360"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MaybeT</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679096954"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096955"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>             </span><span class="hs-comment">-- ^ Deserialized tensor or an error, either way wrapped in the IO monad</span><span>
</span><a name="line-361"></a><span>
</span><a name="line-362"></a><span>
</span><a name="line-363"></a><span class="hs-comment">{-| If container on which tensor instance is built, allows for random access of its elements, then the tensor can be instanced as Accessible -}</span><span>
</span><a name="line-364"></a><span class="hs-keyword">class</span><span> </span><a href="Multilinear.html#Multilinear"><span class="hs-identifier hs-type">Multilinear</span></a><span> </span><a href="#local-6989586621679096951"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096952"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="Accessible"><a href="Multilinear.html#Accessible"><span class="hs-identifier">Accessible</span></a></a><span> </span><a name="local-6989586621679096951"><a href="#local-6989586621679096951"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679096952"><a href="#local-6989586621679096952"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-365"></a><span>
</span><a name="line-366"></a><span>    </span><span class="hs-comment">{-| Accessing tensor elements -}</span><span>
</span><a name="line-367"></a><span>    </span><span class="hs-comment">{-| @el [&quot;i&quot;,&quot;j&quot;] t [4,5]@ returns all tensor elements which index @i@ is equal to 4 and index @j@ is equal to 5.
        Values of other indices are insignificant -}</span><span>
</span><a name="line-369"></a><span>    </span><span class="hs-comment">{-| If given index value is out of range, then modulo operation is performed:
        el [&quot;i&quot;,&quot;j&quot;] t [40 50] = t[40 mod size i, 50 mod size j] -}</span><span>
</span><a name="line-371"></a><span>    </span><span class="hs-identifier">el</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096951"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096952"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096951"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096952"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-372"></a><span>
</span><a name="line-373"></a><span>    </span><span class="hs-comment">{-| Mapping with indices - mapping function takes not only a tensor element value but also its indices in tensor -}</span><span>
</span><a name="line-374"></a><span>    </span><span class="hs-comment">{-| @iMap f t@ return tensor @t2@ in which @t2[i1,i2,...] = f [i1,i2,...] t[i1,i2,...]@ -}</span><span>
</span><a name="line-375"></a><span>    </span><span class="hs-identifier">iMap</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096952"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096953"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096951"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096952"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096951"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096953"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-376"></a><span>    </span><span class="hs-comment">-- // TODO</span><span>
</span><a name="line-377"></a><span>
</span><a name="line-378"></a><span class="hs-keyword">class</span><span> </span><a name="StandardTensor"><a href="Multilinear.html#StandardTensor"><span class="hs-identifier">StandardTensor</span></a></a><span> </span><a name="local-6989586621679096948"><a href="#local-6989586621679096948"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679096949"><a href="#local-6989586621679096949"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679096950"><a href="#local-6989586621679096950"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-379"></a><span>    </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">TensorIndex</span><span> </span><a name="local-6989586621679096948"><a href="#local-6989586621679096948"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679096949"><a href="#local-6989586621679096949"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621679096950"><a href="#local-6989586621679096950"><span class="hs-identifier">a</span></a></a><span>
</span><a name="line-380"></a><span>
</span><a name="line-381"></a><span>    </span><span class="hs-identifier">scalar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679096950"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096948"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096949"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-6989586621679096950"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-382"></a><span>
</span><a name="line-383"></a><span>    </span><span class="hs-identifier">simple</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Multilinear.html#TensorIndex"><span class="hs-identifier hs-type">TensorIndex</span></a><span> </span><a href="#local-6989586621679096948"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096949"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-6989586621679096950"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096949"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-6989586621679096950"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096948"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096949"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-6989586621679096950"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-384"></a><span>
</span><a name="line-385"></a><span>    </span><span class="hs-identifier">tensor</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Multilinear.html#TensorIndex"><span class="hs-identifier hs-type">TensorIndex</span></a><span> </span><a href="#local-6989586621679096948"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096949"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-6989586621679096950"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096949"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679096948"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096949"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-6989586621679096950"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679096948"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679096949"><span class="hs-identifier hs-type">c</span></a><span> </span><a href="#local-6989586621679096950"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-386"></a></pre></body></html>